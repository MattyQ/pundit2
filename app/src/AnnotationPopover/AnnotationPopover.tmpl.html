<div class="popover pnd-popover pnd-annotation-popover"
     ng-class="{
     'pnd-annotation-popover-login': !isUserLogged,
     'pnd-annotation-popover-annotate': isSwitchMode,
     'pnd-annotation-popover-comment': isCommentMode,
     'pnd-annotation-popover-highlight': isHighlightMode,
     'pnd-annotation-popover-saving':savingAnnotation,
     'pnd-annotation-popover-error':!savingAnnotation && errorSaving,
     'pnd-tooltip': tooltip,
     'pnd-annotation-popover-atoka': isAtokaActive}"
     ng-style="{'opacity': opacity}">

    <div class="arrow"></div>

    <!-- Login: user must login -->
    <div class="popover-content"
         ng-if="!isUserLogged">
        <a href="javascript:void(0)" ng-click="login()">{{message}}</a>
    </div>

    <!-- tooltip mode -->
    <div class="popover-content"
         ng-if="tooltip">
        <a href="javascript:void(0)">{{message}}</a>
    </div>

    <!-- Annotation type selection -->
    <div class="popover-content" ng-if="currentMode === '' && isUserLogged">
        <a ng-click="setMode('comment')">Comment</a><span class="pnd-annotation-popover-separator">
        </span><a ng-click="setMode('highlight')">Highlight</a>
    </div>

    <!-- Comment Highlight creation  -->
    <div class="popover-content-wrapper"
         ng-show="!savingAnnotation && !errorSaving"
         ng-if="currentMode !== '' && isUserLogged">

        <div ng-show="isAtokaActive">
            
            <!-- Guidelines for the user -->
            <p class="pnd-annotation-popover-guidelines"
               ng-show="currentMode === 'comment'">
                You are commenting the <strong>Atoka</strong> company:
            </p>
            <p class="pnd-annotation-popover-guidelines"
               ng-show="currentMode != 'comment'">You are highlighting the <strong>Atoka</strong> company:
            </p>

            <div class="company-selector">

                <label>

                    <p class="label">
                        Select a company:
                        <span ng-show="autoCompleteLoading" class="pnd-pulse">(Loading companies .. )</span>
                    </p>

                    <pnd-select
                        options="companiesData"
                        ng-if="!showAutoComplete"
                        selected-value="$parent.$parent.selectedResourceId"
                        action="doAcceptResource"
                        action-toggle-bind="$parent.$parent.showAutoComplete"
                        label-action="'Search more'"
                        placeholder-action="'Type something'"
                        expanded="false"></pnd-select>

                    <input
                        class="form-control"
                        placeholder="Search any Company in Atoka"
                        type="text"
                        ng-if="showAutoComplete"
                        ng-model="companiesSearchText"
                        ng-model-options="{debounce: 1000}"
                        ng-change="handleCompaniesSearchTextChange(companiesSearchText, $parent.autoCompleteItems)"/>

                    <div class="company-selector-autocomplete" ng-if="autoCompleteItems.length > 0">
                        <ul>
                            <li ng-repeat="item in autoCompleteItems" ng-click="acceptAutoCompleteItem(item)">
                                {{item.name}}
                            </li>
                        </ul>
                    </div>

                    <button ng-if="showAutoComplete" ng-click="$parent.$parent.showAutoComplete = false">reset</button>
                </label>
            </div>

            <!-- Company preview -->
            <!--
            <div class="company-preview">
                <div class="company-main-info">
                    <div class="company-thumb">
                        <img src="https://unsplash.it/70/50/?random" alt="">
                    </div>
                    <h1 class="company-name">
                        <a href="http://https://u.atoka.io/azienda/eni-spa/0c7a7e7663ed/">
                            Enogn Biotecnologie Articoli Attrezzature E Macchine Per Enologia Di Nanni G...
                        </a>
                    </h1>
                </div>

                <div class="company-meta">
                    <span class="company-ateco"><span class="label">ATECO: </span>[46.11.01] Agenti e rappresentanti di materie prime agricole</span>
                    <span class="company-sede"><span class="label">Sede legale: </span>Contrada Feudo 36, 66011 Bucchianico (Chieti)</span>
                    <span class="company-link">
                        <a href="http://https://u.atoka.io/azienda/eni-spa/0c7a7e7663ed/" target="_blank">View company in Atoka</a> Â·
                        <span>Select another company</span>
                    </span>
                </div>
            </div>
            -->
            <!-- END // Company preview -->
        </div>

        <div class="popover-content"
             ng-show="currentMode === 'comment'">
            <div class="form-group">
                <textarea
                    id="comment-area"
                    class="form-control pnd-popover-literal-textarea"
                    rows="6"
                    ng-model="$parent.literalText"
                    ng-init="focusOn('comment-area')"></textarea>
            </div>
        </div>

        <!-- Notebook selector -->
        <div 
            class="popover-notebooks" ng-hide = tooltip>
            <span class="popover-notebooks-copy">Save {{currentMode}} in</span>
            <pnd-select
                    options="availableNotebooks"
                    selected-value="$parent.selectedNotebookId"
                    deferred-action="doCreateNewNotebook"
                    label-action="'Create new notebook'"
                    placeholder-action="'Type new notebook name here'"
                    notebook-mode="true"
                    expanded="false"></pnd-select>
        </div>

        <!-- Footer with buttons -->
        <div class="popover-footer" ng-hide = tooltip>
            <button
                    class="pnd-btn pnd-btn-small"
                    ng-click="cancel()">
                Cancel
            </button><button
                class="pnd-btn pnd-btn-small pnd-btn-calltoaction"
                ng-class="{disabled: $parent.literalText == '' && currentMode == 'comment'}"
                ng-click="save()">
                Save
            </button>
        </div>
    </div>

    <div class="popover-content-wrapper"
         ng-show="!savingAnnotation && errorSaving">
        <span class="pnd-icon-exclamation"></span>
        <br />
        There was an error saving your annotation, please try again later
        <br />
        <button
            class="pnd-btn pnd-btn-small"
            ng-click="cancel()">
            Cancel
        </button>
    </div>

    <div class="popover-content-wrapper pnd-pulse"
         ng-show="savingAnnotation">
        Saving your annotation
    </div>
</div>